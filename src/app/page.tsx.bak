"use client";

import React, { useState, useRef, useEffect } from 'react';
import { motion } from 'framer-motion';
import Footer from '@/components/Footer';
import ModalGrid from '@/components/ModalGrid';
import Image from 'next/image';
import MediaCard from '@/components/MediaCard';
import ProjectThumbnailHeader from '@/components/ProjectThumbnailHeader';
import About from './about/page';
import Craft from './craft/page';



//adding a comment
// Main page container variants for staggered loading
const pageContainerVariants = {
  hidden: {},
  visible: {
    transition: {
      staggerChildren: 0.3,
      delayChildren: 0.2
    }
  }
};

// Individual section variants with blur
const sectionVariants = {
  hidden: { 
    opacity: 0, 
    y: 30,
    filter: "blur(4px)"
  },
  visible: { 
    opacity: 1, 
    y: 0,
    filter: "blur(0px)",
    transition: { 
      duration: 0.4,
      ease: "easeOut" as const
    }
  }
};

// Three images stagger variants
const imagesContainerVariants = {
  hidden: {},
  visible: {
    transition: {
      staggerChildren: 0.15,
      delayChildren: 0.1
    }
  }
};

const imageVariants = {
  hidden: { 
    opacity: 0, 
    scale: 0.9,
    filter: "blur(4px)"
  },
  visible: { 
    opacity: 1, 
    scale: 1,
    filter: "blur(0px)",
    transition: { 
      duration: 0.5,
      ease: "easeOut" as const
    }
  }
};

// Moving Background for tabs (mirrors ModalGrid)
const MovingBackground = ({ selectedButton }: { selectedButton: HTMLButtonElement | null }) => (
  <motion.div
    className="absolute h-full rounded-full"
    animate={{
      x: selectedButton?.offsetLeft ?? 0,
      y: selectedButton?.offsetTop ?? 0,
      width: selectedButton?.offsetWidth ?? 0,
      height: selectedButton?.offsetHeight ?? 0,
    }}
    transition={{ type: "spring", stiffness: 600, damping: 40 }}
  >
    <div className="flex items-center justify-between size-fit px-[1px] rounded-full bg-radial-[at_50%_75%] from-blue-400 via-blue-500 to-blue-700 border border-blue-700 shadow-[0px_2px_2px_-1px_rgba(0,0,0,0.25),0px_4px_8px_1px_rgba(10,10,10,0.15)_inset,0px_-2px_2px_0px_rgba(10,10,10,0.15)_inset] h-full w-full">
      <div className="absolute flex inset-2 top-0.5 h-1/2 items-center justify-center bg-gradient-to-b from-white/50 to-white/5 rounded-t-[60px] rounded-b-[16px] z-10" />
    </div>
  </motion.div>
);

export default function Home() {

  const [activeTab, setActiveTab] = useState<"work" | "about" | "craft">("about");
  const [selectedButton, setSelectedButton] = useState<HTMLButtonElement | null>(null);
  const buttonRefs = useRef<Array<HTMLButtonElement | null>>([]);

  const tabs = [
    { id: "work" as const, label: "Work" },
    { id: "about" as const, label: "About" },
    { id: "craft" as const, label: "Craft" },
  ];

  useEffect(() => {
    const index = tabs.findIndex((tab) => tab.id === activeTab);
    setSelectedButton(buttonRefs.current[index] ?? null);
  }, [activeTab]);

  return (
    <div className="min-h-screen flex justify-center">
      <main className="relative w-full md:max-w-[800px] max-w-[361px]">

        <motion.div 
          className="relative flex flex-col gap-16 items-start md:pt-48 pt-8 md:px-0 px-4 md:pb-24 pb-24"
          variants={pageContainerVariants}
          initial="hidden"
          animate="visible"
        >
          
          <motion.div
            variants={sectionVariants}
            className="flex relative "
          >
            {/* top */}
            <div className="absolute -translate-y-1/2 top-1/2 left-0 -translate-x-full -z-10 ">
              <Image 
                src="/images/About/Potrait-Sticker.png"
                alt="Shreyas Patil"
                width={160}
                height={160}
                className=" h-auto object-cover rotate-4"
              />
            </div>
            <div className='flex flex-col gap-4 text-gray-800'>
                  <div className=" text-page-header text-gradient-primary">
                   
                    Shreyas Patil
                  </div>

                  <p className="text-important ">I'm a product designer exploring how humans and computers connect and building the interfaces in between. Based in the Bay Area.</p>

                  {/* <motion.div 
                    className='w-full grid grid-cols-3 gap-4'
                    variants={imagesContainerVariants}
                    initial="hidden"
                    animate="visible"
                  >
                    <motion.div variants={imageVariants}>
                      <MediaCard
                        mediaType="image"
                        src="/images/About/About-1.jpeg"
                        aspectClass="aspect-square"
                      />  
                    </motion.div>

                    <motion.div variants={imageVariants}>
                      <MediaCard
                        mediaType="image"
                        src="/images/About/About-2.jpeg"
                        aspectClass="aspect-square"
                        rightIcon={<Image src="/logos/Swift Icon.svg" alt="Swift Icon" width={20} height={20} className="object-contain" />}
                      />
                    </motion.div>

                    <motion.div variants={imageVariants} className="">
                      <MediaCard
                        mediaType="image"
                        src="/images/About/About-3.jpeg"
                        aspectClass="aspect-square"
                        rightIcon={<Image src="/logos/Create with Play Logo.png" alt="Create with Play Logo" width={20} height={20} className="object-contain " />}
                      />
                    </motion.div>

                  </motion.div> */}
                  
                
            </div>        
          </motion.div>

          {/* Tabs below intro */}
          <motion.div
            variants={sectionVariants}
            className="w-full flex justify-start"
          >
            <div className="relative w-fit flex rounded-full bg-stone-200">
              <MovingBackground selectedButton={selectedButton} />

              {/* Tab buttons */}
              {tabs.map((tab, index) => (
                <button
                  key={tab.id}
                  ref={(el) => {
                    buttonRefs.current[index] = el;
                  }}
                  className={`relative z-10 flex items-center justify-center gap-2 py-1.5 px-5 rounded-full text-body md:text-body font-medium cursor-pointer ${
                    activeTab === tab.id
                      ? "text-white!"
                      : "text-stone-600! hover:text-stone-800!"
                  }`}
                  onClick={() => setActiveTab(tab.id)}
                >
                  <span className="drop-shadow-[0_0.5px_0px_rgba(255,255,255,1)]">
                    {tab.label}
                  </span>
                </button>
              ))}
            </div>
          </motion.div>
          
          {activeTab === "work" && (
            <>
              {/* Projects section */}
              <motion.div 
                className="flex flex-col gap-4 w-full"
                variants={sectionVariants}
              >

                  {/* Section heading */}
                  <h1 className="text-subheader "> 
                    Projects
                  </h1>
                  

                  <div className="w-full flex flex-col gap-16 items-start">
                        
                    <div className="w-full flex flex-col gap-4">
                      
                          <ProjectThumbnailHeader name="Quinn" link="/projects/quinn" />
                          <div className="text-body text-pretty">Quinn is an AI-native relationship intelligence platform that transforms how executives and business leaders manage their professional networks. The product bridges the gap between traditional CRM systems and intelligent relationship management.</div>
                          <div className="relative w-full aspect-4/3 my-4  bg-[url('/images/projects/thumbnails/Quinn-Thumbnail-Background.png')] bg-cover bg-center rounded-2xl -z-10 shadow-[0_0_0_1px_rgba(0,0,0,0.07),0_1px_4px_-0.5px_rgba(0,0,0,0.08),0_4px_4px_-2px_rgba(0,0,0,0.08)] overflow-hidden">
                            <Image src="/images/projects/Dashworks/Dashworks-Onboarding-1.png" alt="Quinn" fill className="object-cover object-center" />
                          </div>
                    </div>

                    <div className="w-full flex flex-col gap-4">
                          <ProjectThumbnailHeader name="ItinerAI" link="/projects/itinerai" />
                          <div className="text-body text-pretty">ItinerAI is an experimental travel assistant where multiple AI agents, each with a distinct personality and focus area, collaborate to help you plan and coordinate trips effortlessly. From surfacing the best flight options to optimizing your itinerary around your schedule, these agents communicate with each other and with you, just like a well-aligned team.</div>
                          <div className="w-full aspect-4/3 my-4 bg-white rounded-2xl -z-10"></div>
                    </div>

                    <div className="w-full flex flex-col gap-4">
                          <ProjectThumbnailHeader name="Dashworks" link="/projects/dashworks" />
                          <div className="text-body text-pretty">Dashworks is an AI-powered knowledge assistant that helps companies centralize their knowledge scattered across various apps. It provides accurate answers to employee questions by searching across the company's connected applications.</div>
                          <div className="w-full aspect-4/3 my-4 bg-white rounded-2xl "></div>
                    </div>

                    <div className="w-full flex flex-col gap-4">
                          <ProjectThumbnailHeader name="WeatherWise" link="/projects/weatherwise" />
                          <div className="text-body text-pretty">Improving Navigational Safety with Weather-Adaptive Routing in Google Maps.</div>
                          <div className="w-full aspect-4/3 my-4 bg-white rounded-2xl "></div>
                    </div>                  
                    
                  </div>

              </motion.div>

              <motion.div 
                className="w-full"
                variants={sectionVariants}
              >
                        <div className="relative w-full h-fit flex flex-col mt-6">
                          <div className='w-full h-fit space-y-3'>
                            <h2 className="w-full text-important font-bold! text-stone-800!">ItinerAI</h2>
                            <div className="text-body text-pretty">My capstone project, where I designed the full experience and built an interactive prototype using Play. Later, I developed an MVP in SwiftUI using Cursor to test feasibility.</div>

                          </div>

                          

                          </div>
                          
                          {/* <div className="grid md:grid-cols-2 grid-cols-1 gap-4 my-6">
                            <MediaCard
                              mediaType="video"
                              src="/videos/Walk-Through-Video.mp4"
                              aspectClass="aspect-3/4"
                              caption="Early ItinerAI Prototype built with Play"
                              rightIcon={<Image src="/logos/Create with Play Logo.png" alt="Create with Play Logo" width={20} height={20} className="object-contain" />}
                              className="w-full"
                              videoAttributes={{ autoPlay: true, muted: true, loop: true, playsInline: true, disablePictureInPicture: true, controlsList: 'nodownload nofullscreen noremoteplayback' }}
                            />

                            <MediaCard
                              mediaType="video"
                              src="/videos/ItinerAIbuild-1.mp4"
                              aspectClass="aspect-3/4"
                              caption="Sorting shared posts with AI - SwiftUI"
                              rightIcon={<Image src="/logos/Swift Icon.svg" alt="Swift Icon" width={20} height={20} className="object-contain" />}
                              className="w-full"
                              videoAttributes={{ autoPlay: true, muted: true, loop: true, playsInline: true, disablePictureInPicture: true, controlsList: 'nodownload nofullscreen noremoteplayback' }}
                            />
                          </div> */}
                          
                        </div>
              
                        {/* Mindlab section */}
                        <div className="relative w-full h-fit flex flex-col gap-1">
                          <div className='w-full h-fit flex flex-col gap-3'>
                            <h2 className="w-full text-important">Mindlab</h2>
                            <div className="text-body">A way to train your thinking muscle with Perplexity. Perplexity makes knowledge accessible, but it&apos;s easy to offload thinking to LLMs. I challenged this by building Mindlab using V0, a prototype that guides thinking instead of spoon-feeding answers, helping users arrive at insights without losing context.</div>
                          </div>
                          
                          <div className="w-full my-6">
                          <MediaCard
                            mediaType="video"
                            src="/images/Craft/pplx-mindlab-1.mp4"
                            aspectClass="aspect-16/9"
                            caption="Guided thinking with AI - V0 prototype"
                            rightIcon={
                              <div className="relative h-6 rounded-md flex items-center justify-center">
                                <Image src="/logos/V0-logo.svg" alt="V0 Logo" width={20} height={20} className="object-contain" />
                                <span className="text-gray-600 text-sm font-medium px-2">+</span>
                                <Image src="/images/About/Cursor-Icon.png" alt="Cursor Icon" width={16} height={16} className="object-contain" />
                              </div>
                            }
                            className="w-full"
                            videoAttributes={{ autoPlay: true, muted: true, loop: true, playsInline: true, disablePictureInPicture: true, controlsList: 'nodownload nofullscreen noremoteplayback' }}
                          />
                          </div>
                        </div>
              
                        {/* AR Navigation section */}
                        <div className="relative w-full h-fit flex flex-col gap-1">
                          <div className='w-full h-fit space-y-3'>
                            <h2 className="w-full text-important">Indoor AR navigation prototype</h2>
                            <div className="md:w-3/4 text-body text-pretty">Built in under 3 hours for a user research study exploring the challenges of indoor navigation and how AR wayfinding can support spatial memory.</div>
                          </div>
                          
                          <div className="w-full md:w-3/4 my-6">
                            <MediaCard
                              mediaType="video"
                              src="/videos/aero_recording.mp4"
                              aspectClass="aspect-square"
                              caption="AR prototype used to study indoor navigation challenges"
                              rightIcon={<Image src="/logos/Adobe Aero SVG Icon.svg" alt="Adobe Aero Icon" width={24} height={24} className="object-contain" />}
                              className="w-full"
                              videoAttributes={{ autoPlay: true, muted: true, loop: true, playsInline: true, disablePictureInPicture: true, controlsList: 'nodownload nofullscreen noremoteplayback' }}
                            />
                          </div>
              
                          
                        </div>
              
              
                        {/* Image Answer Engine section */}
                        <div className="relative w-full h-fit flex flex-col gap-1">
                          <div className='w-full h-fit space-y-3'>
                            <h2 className="w-full text-important">Image Answer Engine Prototype</h2>
                            <div className=" text-body text-pretty">Inspired by Wall-E&apos;s interface and the voice bot showcased in @sbgriffiâ€™s portfolio. The experience focuses on translating user queries into relevant image-based answers with an orchestrated workflow. This initial version tackles core challenges in answer quality, multi-step orchestration, and interface responsiveness.</div>
                          </div>
                          
                          <div className="w-full my-6">
                            <MediaCard
                              mediaType="video"
                              src="/videos/Image-Answer-Engine-Prototype.mp4"
                              aspectClass="aspect-video"
                              caption="Takes a question, finds relevant images, and answers with voice + images."
                              rightIcon={
                                <Image
                                  src="/images/About/Cursor-Icon.png"
                                  alt="Cursor Icon"
                                  width={16}
                                  height={16}
                                  className="object-contain"
                                />
                              }
                              className="w-full"
                              videoAttributes={{
                                autoPlay: true,
                                muted: true,
                                loop: true,
                                playsInline: true,
                                disablePictureInPicture: true,
                                controlsList: 'nodownload nofullscreen noremoteplayback'
                              }}
                            />
                          </div>
              
                          
                        </div>
              
                        {/* Design System section */}
                  <div className="relative w-full h-fit flex flex-col gap-4 mt-20">
                        <div className='w-full flex flex-col gap-3'>
                          <h2 className="w-full text-header text-gradient-primary ">Building Scalable Design Systems</h2>
                          <div className=" text-body text-pretty">At Dashworks, I built a design system that balances flexibility and usability for various workflows. To demonstrate my ability to bring designs to life with precision, I developed select modals using Tailwind below.</div>
                        </div>
                        
                        <div className="relative w-full rounded-2xl overflow-hidden border border-slate-200 my-6">
                          <div className="hidden md:block">
                            <ModalGrid />
                          </div>
                          <div className="md:hidden w-full h-full aspect-4/3 bg-[url('/images/projects/Dashworks/Dashworks-Design-System.png')] bg-cover bg-center"></div>
                        </div>
                  </div>
              </motion.div>

              <motion.div 
                className="w-full"
                variants={sectionVariants}
              >
                <Footer />
              </motion.div>
            </>
          )}

          {activeTab === "about" && (
            <>
              {/* About tab content */}
              <motion.div
                className="flex flex-col gap-6 w-full"
                variants={sectionVariants}
              >
                <About hideHeader hideBackground />
              </motion.div>
            </>
          )}

          {activeTab === "craft" && (
            <>
              {/* Craft tab content */}
              <motion.div
                className="flex flex-col gap-6 w-full"
                variants={sectionVariants}
              >
                <Craft hideHeader hideBackground />
              </motion.div>
            </>
          )}

        </motion.div>
      </main>
    </div>
  );
}